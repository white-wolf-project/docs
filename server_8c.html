<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>Ragnarok: src/server/server.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Ragnarok
   &#160;<span id="projectnumber">0.0.1</span>
   </div>
   <div id="projectbrief">Wifi triangulation tool</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_075bb3ff235063c77951cd176d15a741.html">server</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">server.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>file containing functions for the server.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;stdio.h&gt;</code><br />
<code>#include &lt;stdlib.h&gt;</code><br />
<code>#include &lt;signal.h&gt;</code><br />
<code>#include &lt;unistd.h&gt;</code><br />
<code>#include &lt;errno.h&gt;</code><br />
<code>#include &lt;string.h&gt;</code><br />
<code>#include &lt;netdb.h&gt;</code><br />
<code>#include &lt;time.h&gt;</code><br />
<code>#include &lt;stdbool.h&gt;</code><br />
<code>#include &lt;sys/socket.h&gt;</code><br />
<code>#include &lt;sys/types.h&gt;</code><br />
<code>#include &lt;sys/stat.h&gt;</code><br />
<code>#include &lt;include/common.h&gt;</code><br />
<code>#include &lt;include/server.h&gt;</code><br />
<code>#include &lt;include/server_util.h&gt;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a6a3869251603ae4e569abadbd7dab11c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="server_8c.html#a6a3869251603ae4e569abadbd7dab11c">INThandler</a> (int sig)</td></tr>
<tr class="memdesc:a6a3869251603ae4e569abadbd7dab11c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Catch ctrl+c to close sock and exit correctly Since it's a deamon this function is useless. I keep it for the moment.  <a href="#a6a3869251603ae4e569abadbd7dab11c">More...</a><br /></td></tr>
<tr class="separator:a6a3869251603ae4e569abadbd7dab11c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a59198bf97723088876e665d2c0747c77"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="server_8c.html#a59198bf97723088876e665d2c0747c77">init_srv_daemon</a> (const char *pidfile)</td></tr>
<tr class="memdesc:a59198bf97723088876e665d2c0747c77"><td class="mdescLeft">&#160;</td><td class="mdescRight">init deamon for the server First we check if the pidfile exists. If it exists, it means client is already running. Print pid of process the quit.  <a href="#a59198bf97723088876e665d2c0747c77">More...</a><br /></td></tr>
<tr class="separator:a59198bf97723088876e665d2c0747c77"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae3573993ed51bf82e496a275abf6365a"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="server_8c.html#ae3573993ed51bf82e496a275abf6365a">tcp_server</a> (const char *service_port)</td></tr>
<tr class="memdesc:ae3573993ed51bf82e496a275abf6365a"><td class="mdescLeft">&#160;</td><td class="mdescRight">TCP server function to handle multiple clients.  <a href="#ae3573993ed51bf82e496a275abf6365a">More...</a><br /></td></tr>
<tr class="separator:ae3573993ed51bf82e496a275abf6365a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9b97e50476f33108ada52286acd71b3f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="server_8c.html#a9b97e50476f33108ada52286acd71b3f">manage_co</a> (int sock, int counter)</td></tr>
<tr class="memdesc:a9b97e50476f33108ada52286acd71b3f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Here we deal with the data we received. Data is splited in two file : client.log and server.xml. In server.log, "normal" data from the scan it's for debugging purpose. We also call Python3 scripts to handle XML files, still in early stage for the moment. XML data is stored in server.xml.  <a href="#a9b97e50476f33108ada52286acd71b3f">More...</a><br /></td></tr>
<tr class="separator:a9b97e50476f33108ada52286acd71b3f"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a5903d0b282fc5eae503de618f896b5e1"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a5903d0b282fc5eae503de618f896b5e1"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><b>sock</b></td></tr>
<tr class="separator:a5903d0b282fc5eae503de618f896b5e1"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>file containing functions for the server. </p>
<dl class="section author"><dt>Author</dt><dd>Mathieu Hautebas </dd></dl>
<dl class="section date"><dt>Date</dt><dd>22 March 2018 </dd></dl>
</div><h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="a59198bf97723088876e665d2c0747c77"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int init_srv_daemon </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>pidfile</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>init deamon for the server First we check if the pidfile exists. If it exists, it means client is already running. Print pid of process the quit. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">const</td><td>char *pidfile <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;if (file_exists(pidfile))</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;{</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;    fp = fopen(pidfile, &quot;r&quot;);</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;    fprintf(stdout, &quot;[-] ragnarok is already running\n&quot;);</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;    getline(&amp;pid_val, &amp;len, fp);</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;    fprintf(stdout, &quot;[i] PID = %s\r&quot;, pid_val);</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;    fclose(fp);</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;    exit(-1);</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;}</div></div><!-- fragment --> We create a normal process and a child process. We kill parent process and set a new session. Close stdin, stdout and stderr for ragnarok <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;close(STDIN_FILENO);</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;close(STDOUT_FILENO);</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;close(STDERR_FILENO);</div></div><!-- fragment --> </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>returns 0 if everything's done well or a number != 0 if any issue or just exit(). </dd></dl>
<dl class="section see"><dt>See also</dt><dd><a href="https://www.thegeekstuff.com/2012/02/c-daemon-process/">https://www.thegeekstuff.com/2012/02/c-daemon-process/</a> </dd></dl>

</div>
</div>
<a class="anchor" id="a6a3869251603ae4e569abadbd7dab11c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void INThandler </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>sig</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Catch ctrl+c to close sock and exit correctly Since it's a deamon this function is useless. I keep it for the moment. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">int</td><td>sig : signal </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void, no return just exit() the program </dd></dl>

</div>
</div>
<a class="anchor" id="a9b97e50476f33108ada52286acd71b3f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void manage_co </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>sock</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>counter</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Here we deal with the data we received. Data is splited in two file : client.log and server.xml. In server.log, "normal" data from the scan it's for debugging purpose. We also call Python3 scripts to handle XML files, still in early stage for the moment. XML data is stored in server.xml. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">int</td><td>sock : socket of the server </td></tr>
    <tr><td class="paramname">int</td><td>counter : count number of opened sessions, once counter hits 3, run python script will all 3 xml files </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="ae3573993ed51bf82e496a275abf6365a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int tcp_server </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>service_port</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>TCP server function to handle multiple clients. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">const</td><td>char* service_port </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>returns 0 if everything's done well or a number != 0 if any issue or just exit(). </dd></dl>
<dl class="section see"><dt>See also</dt><dd><a href="https://www.thegeekstuff.com/2012/02/c-daemon-process/">https://www.thegeekstuff.com/2012/02/c-daemon-process/</a> </dd></dl>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
